<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Gunnuu Bakers</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .admin-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background: var(--primary-color);
            color: white;
            padding: 2rem;
        }

        .sidebar h2 {
            color: var(--accent-color);
            margin-bottom: 3rem;
        }

        .sidebar a {
            display: block;
            color: rgba(255, 255, 255, 0.8);
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar a:hover {
            color: white;
            padding-left: 10px;
        }

        .main-content {
            background: #f4f6f8;
            padding: 2rem;
        }

        .card {
            background: white;
            padding: 2rem;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-sm);
            margin-bottom: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th,
        td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #fafafa;
        }
    </style>
</head>

<body>

    <div class="admin-layout">
        <!-- Sidebar -->
        <div class="sidebar">
            <h2>Gunnuu Admin</h2>
            <a href="#" class="active"><i class="fas fa-box"></i> Products</a>
            <a href="#" onclick="alert('Coming soon!')"><i class="fas fa-users"></i> Customers</a>
            <a href="#" onclick="alert('Coming soon!')"><i class="fas fa-chart-line"></i> Analytics</a>
            <a href="#" onclick="logoutBtn()"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <h1>Product Management</h1>

            <!-- Add Product -->
            <div class="card">
                <h3>Add New Product</h3>
                <form id="addProductForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Product Name</label>
                            <input type="text" id="pName" required>
                        </div>
                        <div class="form-group">
                            <label>Category</label>
                            <select id="pCategory">
                                <option value="cakes">Cakes</option>
                                <option value="cupcakes">Cupcakes & Breads</option>
                                <option value="cookies">Cookies</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Price (₹)</label>
                            <input type="number" id="pPrice" required>
                        </div>
                        <div class="form-group">
                            <label>Unit (e.g., kg, pc)</label>
                            <input type="text" id="pUnit" required>
                        </div>
                        <div class="form-group" style="grid-column: span 2;">
                            <label>Image Path/URL</label>
                            <input type="text" id="pImage" placeholder="assets/images/..." required>
                        </div>
                        <div class="form-group" style="grid-column: span 2;">
                            <label>Description</label>
                            <textarea id="pDesc" rows="2" required></textarea>
                        </div>
                    </div>
                    <button type="submit" class="btn">Add Product</button>
                </form>
            </div>

            <!-- List -->
            <div class="card">
                <h3>Current Products</h3>
                <table id="productsTable">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Name</th>
                            <th>Price</th>
                            <th>Category</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="productsBody">
                        <!-- JS renders here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script type="module">
        import { checkAuth, logout } from './js/auth.js';

        // Auth Check
        checkAuth();
        window.logoutBtn = logout;

        const PRODUCTS_KEY = 'gunnuu_products';

        // Load or Init
        function getProducts() {
            return JSON.parse(localStorage.getItem(PRODUCTS_KEY) || '[]');
        }

        // Render
        function renderTable() {
            const products = getProducts();
            const tbody = document.getElementById('productsBody');
            tbody.innerHTML = '';

            products.forEach(p => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><img src="${p.image}" style="width: 40px; height: 40px; object-fit: cover; border-radius: 5px;"></td>
                    <td>${p.name}</td>
                    <td>₹${p.price} / ${p.unit}</td>
                    <td>${p.category}</td>
                    <td>
                        <button onclick="window.deleteProduct(${p.id})" style="color: red; border: none; background: none; cursor: pointer;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Add
        document.getElementById('addProductForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const products = getProducts();
            const newProduct = {
                id: Date.now(),
                name: document.getElementById('pName').value,
                category: document.getElementById('pCategory').value,
                price: parseInt(document.getElementById('pPrice').value),
                unit: document.getElementById('pUnit').value,
                image: document.getElementById('pImage').value,
                desc: document.getElementById('pDesc').value
            };

            products.push(newProduct);
            localStorage.setItem(PRODUCTS_KEY, JSON.stringify(products));

            e.target.reset();
            renderTable();
            alert('Product Added!');
        });

        // Delete
        window.deleteProduct = (id) => {
            if (confirm('Are you sure?')) {
                let products = getProducts();
                products = products.filter(p => p.id !== id);
                localStorage.setItem(PRODUCTS_KEY, JSON.stringify(products));
                renderTable();
            }
        };

        // Init
        renderTable();
    </script>
</body>

</html>